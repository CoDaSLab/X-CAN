
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   <!--
This HTML was auto-generated from MATLAB code.
To make changes, update the MATLAB code and republish this document.
      --><title>ej_animal</title><meta name="generator" content="MATLAB 9.1"><link rel="schema.DC" href="http://purl.org/dc/elements/1.1/"><meta name="DC.date" content="2025-02-04"><meta name="DC.source" content="ej_animal.m"><style type="text/css">
html,body,div,span,applet,object,iframe,h1,h2,h3,h4,h5,h6,p,blockquote,pre,a,abbr,acronym,address,big,cite,code,del,dfn,em,font,img,ins,kbd,q,s,samp,small,strike,strong,sub,sup,tt,var,b,u,i,center,dl,dt,dd,ol,ul,li,fieldset,form,label,legend,table,caption,tbody,tfoot,thead,tr,th,td{margin:0;padding:0;border:0;outline:0;font-size:100%;vertical-align:baseline;background:transparent}body{line-height:1}ol,ul{list-style:none}blockquote,q{quotes:none}blockquote:before,blockquote:after,q:before,q:after{content:'';content:none}:focus{outine:0}ins{text-decoration:none}del{text-decoration:line-through}table{border-collapse:collapse;border-spacing:0}

html { min-height:100%; margin-bottom:1px; }
html body { height:100%; margin:0px; font-family:Arial, Helvetica, sans-serif; font-size:10px; color:#000; line-height:140%; background:#fff none; overflow-y:scroll; }
html body td { vertical-align:top; text-align:left; }

h1 { padding:0px; margin:0px 0px 25px; font-family:Arial, Helvetica, sans-serif; font-size:1.5em; color:#d55000; line-height:100%; font-weight:normal; }
h2 { padding:0px; margin:0px 0px 8px; font-family:Arial, Helvetica, sans-serif; font-size:1.2em; color:#000; font-weight:bold; line-height:140%; border-bottom:1px solid #d6d4d4; display:block; }
h3 { padding:0px; margin:0px 0px 5px; font-family:Arial, Helvetica, sans-serif; font-size:1.1em; color:#000; font-weight:bold; line-height:140%; }

a { color:#005fce; text-decoration:none; }
a:hover { color:#005fce; text-decoration:underline; }
a:visited { color:#004aa0; text-decoration:none; }

p { padding:0px; margin:0px 0px 20px; }
img { padding:0px; margin:0px 0px 20px; border:none; }
p img, pre img, tt img, li img, h1 img, h2 img { margin-bottom:0px; } 

ul { padding:0px; margin:0px 0px 20px 23px; list-style:square; }
ul li { padding:0px; margin:0px 0px 7px 0px; }
ul li ul { padding:5px 0px 0px; margin:0px 0px 7px 23px; }
ul li ol li { list-style:decimal; }
ol { padding:0px; margin:0px 0px 20px 0px; list-style:decimal; }
ol li { padding:0px; margin:0px 0px 7px 23px; list-style-type:decimal; }
ol li ol { padding:5px 0px 0px; margin:0px 0px 7px 0px; }
ol li ol li { list-style-type:lower-alpha; }
ol li ul { padding-top:7px; }
ol li ul li { list-style:square; }

.content { font-size:1.2em; line-height:140%; padding: 20px; }

pre, code { font-size:12px; }
tt { font-size: 1.2em; }
pre { margin:0px 0px 20px; }
pre.codeinput { padding:10px; border:1px solid #d3d3d3; background:#f7f7f7; }
pre.codeoutput { padding:10px 11px; margin:0px 0px 20px; color:#4c4c4c; }
pre.error { color:red; }

@media print { pre.codeinput, pre.codeoutput { word-wrap:break-word; width:100%; } }

span.keyword { color:#0000FF }
span.comment { color:#228B22 }
span.string { color:#A020F0 }
span.untermstring { color:#B20000 }
span.syscmd { color:#B28C00 }

.footer { width:auto; padding:10px 0px; margin:25px 0px 0px; border-top:1px dotted #878787; font-size:0.8em; line-height:140%; font-style:italic; color:#878787; text-align:left; float:none; }
.footer p { margin:0px; }
.footer a { color:#878787; }
.footer a:hover { color:#878787; text-decoration:underline; }
.footer a:visited { color:#878787; }

table th { padding:7px 5px; text-align:left; vertical-align:middle; border: 1px solid #d6d4d4; font-weight:bold; }
table td { padding:7px 5px; text-align:left; vertical-align:top; border:1px solid #d6d4d4; }





  </style></head><body><div class="content"><h2>Contents</h2><div><ul><li><a href="#1">XCAN example of animal data</a></li><li><a href="#2">Data viz</a></li><li><a href="#3">Cross-product (XP) matrices</a></li><li><a href="#4">XCAN: X-thresholding</a></li></ul></div><h2 id="1">XCAN example of animal data</h2><p>J. Camacho, E. Acar, M. Rasmussen, R. Bro. Cross-product Penalized Component Analysis (XCAN), Submitted to Chemometrics and Intelligent Laboratory Systems, 2019.</p><p>Needs the MEDA Toolbox (v1.6) and the XCAN (path should be properly set)</p><p>If you use these data, please add a reference to the below paper:</p><p>R. Bro, E.E. Papalexakis, E. Acar, N.D. Sidiropoulos. Coclustering- a useful tool for chemometrics. Journal of Chemometrics 26(6):256-263</p><p>coded by: Jose Camacho (<a href="mailto:josecamacho@ugr.es">josecamacho@ugr.es</a>) last modification: 04/Feb/2025</p><p>Copyright (C) 2025  University of Granada, Granada</p><p>This program is free software: you can redistribute it and/or modify it under the terms of the GNU General Public License as published by the Free Software Foundation, either version 3 of the License, or (at your option) any later version.</p><p>This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License for more details.</p><p>You should have received a copy of the GNU General Public License along with this program.  If not, see <a href="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</a>.</p><pre class="codeinput">close <span class="string">all</span>
clear
clc
</pre><h2 id="2">Data viz</h2><pre class="codeinput">[Xa,txt] = xlsread(<span class="string">'data/Animaldata.xlsx'</span>);
vars_l = txt(1,2:end);
obs_l =  txt(2:end,1);

<span class="comment">% PCA scores and loadings</span>
scoresPca(Xa,<span class="string">'PCs'</span>,1:2,<span class="string">'Preprocessing'</span>,2,<span class="string">'ObsLabel'</span>,obs_l);
loadingsPca(Xa,<span class="string">'PCs'</span>,1:2,<span class="string">'Preprocessing'</span>,2,<span class="string">'VarsLabel'</span>,vars_l);

[X,m] = preprocess2D(Xa,<span class="string">'Preprocessing'</span>,2);
Xa = X+ones(size(X,1),1)*m;
</pre><img vspace="5" hspace="5" src="ej_animal_01.png" style="width:560px;height:420px;" alt=""> <img vspace="5" hspace="5" src="ej_animal_02.png" style="width:560px;height:420px;" alt=""> <h2 id="3">Cross-product (XP) matrices</h2><pre class="codeinput"><span class="comment">% XP matrices with no thresholding</span>

XXt = crossprod(X');
plotMap(XXt);
ylabel(<span class="string">'XXt'</span>,<span class="string">'FontSize'</span>,20);

XtX = crossprod(X);
plotMap(XtX);
ylabel(<span class="string">'XtX'</span>,<span class="string">'FontSize'</span>,20);

<span class="comment">% XP matrices after thresholding</span>

thr = 0.5;
XXt = crossprod(X');
r = find((XXt)&lt;thr);
XXt(r) = 0;
plotMap(XXt);
ylabel(<span class="string">'XXt'</span>,<span class="string">'FontSize'</span>,20);

thr = 0.5;
XtX = crossprod(X);
r = find(abs(XtX)&lt;thr);
XtX(r) = 0;
plotMap(XtX);
ylabel(<span class="string">'XtX'</span>,<span class="string">'FontSize'</span>,20);
</pre><img vspace="5" hspace="5" src="ej_animal_03.png" style="width:560px;height:420px;" alt=""> <img vspace="5" hspace="5" src="ej_animal_04.png" style="width:560px;height:420px;" alt=""> <img vspace="5" hspace="5" src="ej_animal_05.png" style="width:560px;height:420px;" alt=""> <img vspace="5" hspace="5" src="ej_animal_06.png" style="width:560px;height:420px;" alt=""> <h2 id="4">XCAN: X-thresholding</h2><pre class="codeinput">L=0.01;
lambdas = [L;L];
pcs = [9];

Data = X;

<span class="keyword">for</span> i=1:size(lambdas,2)

   [XP, XT] = xcan(Data,1:pcs(i),XtX,lambdas(1,i),XXt,lambdas(2,i));

   varX = trace(Data'*Data);
   <span class="keyword">for</span> j = 1:pcs(i)
       sPjind = find(abs(XT(:,j))==max(abs(XT(:,j))),1);
       sPj = sign(XT(sPjind,j));

       Xp = (XT(:,j)*pinv(XT(:,j)'*XT(:,j))*XT(:,j)')*Data*(XP(:,j)*pinv(XP(:,j)'*XP(:,j))*XP(:,j)');
       varP = trace(Xp'*Xp);

       f = figure, subplot(2,1,1),
       title(sprintf(<span class="string">'XC: %i, variance: %.2f%%'</span>,j,100*(varP)/varX),<span class="string">'FontSize'</span>,20)
       hold <span class="string">on</span>,  bar(sPj*XT(:,j)), a=get(f,<span class="string">'Children'</span>); a.XTick = 1:length(obs_l); a.XTickLabel =  obs_l; a.XTickLabelRotation = 45; box <span class="string">on</span>

       ylabel(<span class="string">'Scores'</span>,<span class="string">'FontSize'</span>,16), subplot(2,1,2), bar(sPj*XP(:,j)), ylabel(<span class="string">'Loadings'</span>,<span class="string">'FontSize'</span>,16),
       a=get(f,<span class="string">'Children'</span>);  a(1).XTick = 1:length(vars_l); a(1).XTickLabel =  vars_l; a(1).XTickLabelRotation = 45; box <span class="string">on</span>
       axis([0.5,length(XP(:,j))+0.5,-1.1,1.1]),
    <span class="keyword">end</span>

   E = Data - XT*XP';
   varE = trace(E'*E);
   ResidualVar = 100*(varE)/varX
<span class="keyword">end</span>
</pre><pre class="codeoutput"> Iter  FuncEvals       F(X)          ||G(X)||/N        
------ --------- ---------------- ----------------
     0         1    1397.00412989       2.78066444
   100       386       1.02329161       0.00045251
   200       639       1.01477046       0.00019456
   300       895       1.00407714       0.00083740
   400      1142       0.99776583       0.00023066
   500      1383       0.99685944       0.00004314
   600      1604       0.99672106       0.00003795
   700      1816       0.99668775       0.00000556
   800      2020       0.99667999       0.00001339
   802      2024       0.99667992       0.00000355

f = 

  Figure (7) with properties:

      Number: 7
        Name: ''
       Color: [0.9400 0.9400 0.9400]
    Position: [404 390 560 420]
       Units: 'pixels'

  Use GET to show all properties


f = 

  Figure (8) with properties:

      Number: 8
        Name: ''
       Color: [0.9400 0.9400 0.9400]
    Position: [404 390 560 420]
       Units: 'pixels'

  Use GET to show all properties


f = 

  Figure (9) with properties:

      Number: 9
        Name: ''
       Color: [0.9400 0.9400 0.9400]
    Position: [404 390 560 420]
       Units: 'pixels'

  Use GET to show all properties


f = 

  Figure (10) with properties:

      Number: 10
        Name: ''
       Color: [0.9400 0.9400 0.9400]
    Position: [404 390 560 420]
       Units: 'pixels'

  Use GET to show all properties


f = 

  Figure (11) with properties:

      Number: 11
        Name: ''
       Color: [0.9400 0.9400 0.9400]
    Position: [404 390 560 420]
       Units: 'pixels'

  Use GET to show all properties


f = 

  Figure (12) with properties:

      Number: 12
        Name: ''
       Color: [0.9400 0.9400 0.9400]
    Position: [404 390 560 420]
       Units: 'pixels'

  Use GET to show all properties


f = 

  Figure (13) with properties:

      Number: 13
        Name: ''
       Color: [0.9400 0.9400 0.9400]
    Position: [404 390 560 420]
       Units: 'pixels'

  Use GET to show all properties


f = 

  Figure (14) with properties:

      Number: 14
        Name: ''
       Color: [0.9400 0.9400 0.9400]
    Position: [404 390 560 420]
       Units: 'pixels'

  Use GET to show all properties


f = 

  Figure (15) with properties:

      Number: 15
        Name: ''
       Color: [0.9400 0.9400 0.9400]
    Position: [404 390 560 420]
       Units: 'pixels'

  Use GET to show all properties


ResidualVar =

   79.0138

</pre><img vspace="5" hspace="5" src="ej_animal_07.png" style="width:560px;height:420px;" alt=""> <img vspace="5" hspace="5" src="ej_animal_08.png" style="width:560px;height:420px;" alt=""> <img vspace="5" hspace="5" src="ej_animal_09.png" style="width:560px;height:420px;" alt=""> <img vspace="5" hspace="5" src="ej_animal_10.png" style="width:560px;height:420px;" alt=""> <img vspace="5" hspace="5" src="ej_animal_11.png" style="width:560px;height:420px;" alt=""> <img vspace="5" hspace="5" src="ej_animal_12.png" style="width:560px;height:420px;" alt=""> <img vspace="5" hspace="5" src="ej_animal_13.png" style="width:560px;height:420px;" alt=""> <img vspace="5" hspace="5" src="ej_animal_14.png" style="width:560px;height:420px;" alt=""> <img vspace="5" hspace="5" src="ej_animal_15.png" style="width:560px;height:420px;" alt=""> <p class="footer"><br><a href="http://www.mathworks.com/products/matlab/">Published with MATLAB&reg; R2016b</a><br></p></div><!--
##### SOURCE BEGIN #####
%% XCAN example of animal data
% J. Camacho, E. Acar, M. Rasmussen, R. Bro. Cross-product Penalized 
% Component Analysis (XCAN), Submitted to Chemometrics and Intelligent 
% Laboratory Systems, 2019.
%
% Needs the MEDA Toolbox (v1.6) and the XCAN (path should be properly set)
%
% If you use these data, please add a reference to the below paper:
%
% R. Bro, E.E. Papalexakis, E. Acar, N.D. Sidiropoulos. Coclustering-
% a useful tool for chemometrics. Journal of Chemometrics 26(6):256-263
%
% coded by: Jose Camacho (josecamacho@ugr.es)
% last modification: 04/Feb/2025
%
% Copyright (C) 2025  University of Granada, Granada
% 
% This program is free software: you can redistribute it and/or modify
% it under the terms of the GNU General Public License as published by
% the Free Software Foundation, either version 3 of the License, or
% (at your option) any later version.
% 
% This program is distributed in the hope that it will be useful,
% but WITHOUT ANY WARRANTY; without even the implied warranty of
% MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
% GNU General Public License for more details.
% 
% You should have received a copy of the GNU General Public License
% along with this program.  If not, see <http://www.gnu.org/licenses/>.

close all
clear
clc


%% Data viz

[Xa,txt] = xlsread('data/Animaldata.xlsx');
vars_l = txt(1,2:end);
obs_l =  txt(2:end,1);

% PCA scores and loadings
scoresPca(Xa,'PCs',1:2,'Preprocessing',2,'ObsLabel',obs_l);
loadingsPca(Xa,'PCs',1:2,'Preprocessing',2,'VarsLabel',vars_l);

[X,m] = preprocess2D(Xa,'Preprocessing',2);
Xa = X+ones(size(X,1),1)*m;

%% Cross-product (XP) matrices

% XP matrices with no thresholding

XXt = crossprod(X');
plotMap(XXt);
ylabel('XXt','FontSize',20);

XtX = crossprod(X);
plotMap(XtX);
ylabel('XtX','FontSize',20);

% XP matrices after thresholding

thr = 0.5; 
XXt = crossprod(X');
r = find((XXt)<thr);
XXt(r) = 0;
plotMap(XXt);
ylabel('XXt','FontSize',20);

thr = 0.5; 
XtX = crossprod(X);
r = find(abs(XtX)<thr);
XtX(r) = 0;
plotMap(XtX);
ylabel('XtX','FontSize',20);


%% XCAN: X-thresholding

L=0.01;
lambdas = [L;L];
pcs = [9];

Data = X;

for i=1:size(lambdas,2)
    
   [XP, XT] = xcan(Data,1:pcs(i),XtX,lambdas(1,i),XXt,lambdas(2,i));     

   varX = trace(Data'*Data);
   for j = 1:pcs(i)
       sPjind = find(abs(XT(:,j))==max(abs(XT(:,j))),1);
       sPj = sign(XT(sPjind,j));
       
       Xp = (XT(:,j)*pinv(XT(:,j)'*XT(:,j))*XT(:,j)')*Data*(XP(:,j)*pinv(XP(:,j)'*XP(:,j))*XP(:,j)');
       varP = trace(Xp'*Xp);
        
       f = figure, subplot(2,1,1),
       title(sprintf('XC: %i, variance: %.2f%%',j,100*(varP)/varX),'FontSize',20)
       hold on,  bar(sPj*XT(:,j)), a=get(f,'Children'); a.XTick = 1:length(obs_l); a.XTickLabel =  obs_l; a.XTickLabelRotation = 45; box on
       
       ylabel('Scores','FontSize',16), subplot(2,1,2), bar(sPj*XP(:,j)), ylabel('Loadings','FontSize',16),
       a=get(f,'Children');  a(1).XTick = 1:length(vars_l); a(1).XTickLabel =  vars_l; a(1).XTickLabelRotation = 45; box on
       axis([0.5,length(XP(:,j))+0.5,-1.1,1.1]),     
    end
        
   E = Data - XT*XP';        
   varE = trace(E'*E);
   ResidualVar = 100*(varE)/varX 
end




##### SOURCE END #####
--></body></html>