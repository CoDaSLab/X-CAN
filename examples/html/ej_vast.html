
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   <!--
This HTML was auto-generated from MATLAB code.
To make changes, update the MATLAB code and republish this document.
      --><title>XCAN example of VAST data</title><meta name="generator" content="MATLAB 9.1"><link rel="schema.DC" href="http://purl.org/dc/elements/1.1/"><meta name="DC.date" content="2025-02-05"><meta name="DC.source" content="ej_vast.m"><style type="text/css">
html,body,div,span,applet,object,iframe,h1,h2,h3,h4,h5,h6,p,blockquote,pre,a,abbr,acronym,address,big,cite,code,del,dfn,em,font,img,ins,kbd,q,s,samp,small,strike,strong,sub,sup,tt,var,b,u,i,center,dl,dt,dd,ol,ul,li,fieldset,form,label,legend,table,caption,tbody,tfoot,thead,tr,th,td{margin:0;padding:0;border:0;outline:0;font-size:100%;vertical-align:baseline;background:transparent}body{line-height:1}ol,ul{list-style:none}blockquote,q{quotes:none}blockquote:before,blockquote:after,q:before,q:after{content:'';content:none}:focus{outine:0}ins{text-decoration:none}del{text-decoration:line-through}table{border-collapse:collapse;border-spacing:0}

html { min-height:100%; margin-bottom:1px; }
html body { height:100%; margin:0px; font-family:Arial, Helvetica, sans-serif; font-size:10px; color:#000; line-height:140%; background:#fff none; overflow-y:scroll; }
html body td { vertical-align:top; text-align:left; }

h1 { padding:0px; margin:0px 0px 25px; font-family:Arial, Helvetica, sans-serif; font-size:1.5em; color:#d55000; line-height:100%; font-weight:normal; }
h2 { padding:0px; margin:0px 0px 8px; font-family:Arial, Helvetica, sans-serif; font-size:1.2em; color:#000; font-weight:bold; line-height:140%; border-bottom:1px solid #d6d4d4; display:block; }
h3 { padding:0px; margin:0px 0px 5px; font-family:Arial, Helvetica, sans-serif; font-size:1.1em; color:#000; font-weight:bold; line-height:140%; }

a { color:#005fce; text-decoration:none; }
a:hover { color:#005fce; text-decoration:underline; }
a:visited { color:#004aa0; text-decoration:none; }

p { padding:0px; margin:0px 0px 20px; }
img { padding:0px; margin:0px 0px 20px; border:none; }
p img, pre img, tt img, li img, h1 img, h2 img { margin-bottom:0px; } 

ul { padding:0px; margin:0px 0px 20px 23px; list-style:square; }
ul li { padding:0px; margin:0px 0px 7px 0px; }
ul li ul { padding:5px 0px 0px; margin:0px 0px 7px 23px; }
ul li ol li { list-style:decimal; }
ol { padding:0px; margin:0px 0px 20px 0px; list-style:decimal; }
ol li { padding:0px; margin:0px 0px 7px 23px; list-style-type:decimal; }
ol li ol { padding:5px 0px 0px; margin:0px 0px 7px 0px; }
ol li ol li { list-style-type:lower-alpha; }
ol li ul { padding-top:7px; }
ol li ul li { list-style:square; }

.content { font-size:1.2em; line-height:140%; padding: 20px; }

pre, code { font-size:12px; }
tt { font-size: 1.2em; }
pre { margin:0px 0px 20px; }
pre.codeinput { padding:10px; border:1px solid #d3d3d3; background:#f7f7f7; }
pre.codeoutput { padding:10px 11px; margin:0px 0px 20px; color:#4c4c4c; }
pre.error { color:red; }

@media print { pre.codeinput, pre.codeoutput { word-wrap:break-word; width:100%; } }

span.keyword { color:#0000FF }
span.comment { color:#228B22 }
span.string { color:#A020F0 }
span.untermstring { color:#B20000 }
span.syscmd { color:#B28C00 }

.footer { width:auto; padding:10px 0px; margin:25px 0px 0px; border-top:1px dotted #878787; font-size:0.8em; line-height:140%; font-style:italic; color:#878787; text-align:left; float:none; }
.footer p { margin:0px; }
.footer a { color:#878787; }
.footer a:hover { color:#878787; text-decoration:underline; }
.footer a:visited { color:#878787; }

table th { padding:7px 5px; text-align:left; vertical-align:middle; border: 1px solid #d6d4d4; font-weight:bold; }
table td { padding:7px 5px; text-align:left; vertical-align:top; border:1px solid #d6d4d4; }





  </style></head><body><div class="content"><h1>XCAN example of VAST data</h1><!--introduction--><p>J. Camacho, E. Acar, M. Rasmussen, R. Bro. Cross-product Penalized Component Analysis (XCAN), Submitted to Chemometrics and Intelligent Laboratory Systems, 2019.</p><p>Needs the MEDA Toolbox (v1.6), the XCAN (path should be properly set, see README file) and Poblano Toolbox (v1.2)</p><p>If you use these data, please add a reference to the below paper:</p><pre class="language-matlab">Camacho, J., Rodr&iacute;guez-G&oacute;mez, R., Saccenti, E. Group-wise Principal
Component <span class="string">Analysis</span> <span class="string">for</span> <span class="string">Exploratory</span> <span class="string">Data</span> <span class="string">Analysis.</span> <span class="string">Journal</span> <span class="string">of</span>
Computational <span class="string">and</span> <span class="string">Graphical</span> <span class="string">Statistics</span> , 2017, 26 (3): 501-512.
</pre><pre class="language-matlab">Camacho, J., Maci&aacute;-Fern&aacute;ndez, G., D&iacute;az-Verdejo, J., Garc&iacute;a-Teodoro, P.
Tackling <span class="string">the</span> <span class="string">Big</span> <span class="string">Data</span> <span class="string">4</span> <span class="string">Vs</span> <span class="string">for</span> <span class="string">Anomaly</span> <span class="string">Detection.</span> <span class="untermstring">INFOCOM'2014 Workshop</span>
on <span class="string">Security</span> <span class="string">and</span> <span class="string">Privacy</span> <span class="string">in</span> <span class="string">Big</span> <span class="string">Data</span>, Toronto (Canada), 2014.
</pre><p>The VAST 2012 2nd mini challenge is a benchmark for visualization in cybersecurity (<a href="http://www.vacommunity.org/VAST+Challenge+2012">http://www.vacommunity.org/VAST+Challenge+2012</a>)</p><p>The goal is to identify cybersecurity issues in the data collected during two days from a computer network. During those days, a number of non-legitimate programs were found to be running on several computers, slowing them down. A cyber-forensics operation is required to discover the root causes for this strange behavior.</p><p>Two typical sources of data are collected from the network: firewall and Intrusion Detection System (IDS) logs. The firewall analyses the incoming and outgoing data traffic in the network, and records in a log file all connection attempts that are blocked according to security policies. The IDS employs higher level intelligence to identify cybersecurity incidents in data traffic. It also stores the results in a log file, though it does not block any traffic connection. Also, typically, it only analyses a sub-set (sample) of the total traffic.</p><p>A total of 2350 observations, each one with the information for one minute, are obtained. For every sampling period of one minute, we defined a set of 112 variables that represent the information from the two data sources: 69 variables for the firewall log and 43 for the IDS log. The number of variables was reduced to 95 by discarding those with constant value throughout the capture period. The definition of the variables is introduced in Tackling the Big Data 4 Vs for Anomaly Detection. INFOCOM'2014 Workshop on Security and Privacy in Big Data, Toronto (Canada), 2014.</p><p>coded by: Jose Camacho Paez (<a href="mailto:josecamacho@ugr.es">josecamacho@ugr.es</a>) last modification: 04/Feb/2025</p><p>Copyright (C) 2025  University of Granada, Granada</p><p>This program is free software: you can redistribute it and/or modify it under the terms of the GNU General Public License as published by the Free Software Foundation, either version 3 of the License, or (at your option) any later version.</p><p>This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License for more details.</p><p>You should have received a copy of the GNU General Public License along with this program.  If not, see <a href="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</a>.</p><!--/introduction--><h2>Contents</h2><div><ul><li><a href="#1">Inicialization, remember to set the path of the toolbox</a></li><li><a href="#2">Data prep &amp; Selection of the PCs</a></li><li><a href="#3">Cross-product (XP) matrices</a></li><li><a href="#4">GPCA: Centered data + X-thresholding</a></li><li><a href="#5">XCAN: Centered data + X-thresholding</a></li><li><a href="#6">XCAN (only in the rows): Centered data + X-thresholding</a></li></ul></div><h2 id="1">Inicialization, remember to set the path of the toolbox</h2><pre class="codeinput">clear
close <span class="string">all</span>
clc
</pre><h2 id="2">Data prep &amp; Selection of the PCs</h2><pre class="codeinput">load <span class="string">data/VAST</span>

xcs = preprocess2D(x,<span class="string">'Preprocess'</span>,2,<span class="string">'Weights'</span>,weight_alt);

varPca(xcs,<span class="string">'Pcs'</span>,0:30,<span class="string">'Preprocessing'</span>,0); <span class="comment">% 12 PCS could be a choice</span>
</pre><img vspace="5" hspace="5" src="ej_vast_01.png" style="width:560px;height:420px;" alt=""> <h2 id="3">Cross-product (XP) matrices</h2><pre class="codeinput"><span class="comment">% XP matrices with no thresholding</span>

meda_map = crossprod(xcs);
[meda_map2,ord] = seriation(meda_map);
plotMap(meda_map2);
ylabel(<span class="string">'XtX'</span>,<span class="string">'FontSize'</span>,20);

map_obs = crossprod(xcs');
plotMap(seriation(map_obs));
ylabel(<span class="string">'XXt'</span>,<span class="string">'FontSize'</span>,16);

save <span class="string">data/vast_stuff_xp</span>

<span class="comment">% XP matrices after thresholding</span>

thr = 0.7;
r = find(meda_map&lt;thr);
meda_map(r) = 0;
[meda_map2,ord] = seriation(meda_map);
plotMap(meda_map2);
ylabel(<span class="string">'XtX'</span>,<span class="string">'FontSize'</span>,16);

thr = 0.3;
r = find(map_obs&lt;thr);
map_obs(r) = 0;
plotMap(seriation(map_obs));
ylabel(<span class="string">'XXt'</span>,<span class="string">'FontSize'</span>,16);

save <span class="string">data/vast_stuff_thr_xp</span>
</pre><pre class="codeoutput">Warning: Figure is saved in
data/vast_stuff_xp.mat.
Saving graphics handle
variables can cause the
creation of very large
files. To save graphics
figures, use &lt;a
href="matlab:helpview([docroot,'/techdoc/ref/savefig.html'])"&gt;savefig&lt;/a&gt;. 
Warning: Figure is saved in
data/vast_stuff_thr_xp.mat.
Saving graphics handle
variables can cause the
creation of very large
files. To save graphics
figures, use &lt;a
href="matlab:helpview([docroot,'/techdoc/ref/savefig.html'])"&gt;savefig&lt;/a&gt;. 
</pre><img vspace="5" hspace="5" src="ej_vast_02.png" style="width:560px;height:420px;" alt=""> <img vspace="5" hspace="5" src="ej_vast_03.png" style="width:560px;height:420px;" alt=""> <img vspace="5" hspace="5" src="ej_vast_04.png" style="width:560px;height:420px;" alt=""> <img vspace="5" hspace="5" src="ej_vast_05.png" style="width:560px;height:420px;" alt=""> <h2 id="4">GPCA: Centered data + X-thresholding</h2><pre class="codeinput">close <span class="string">all</span>
clc
load <span class="string">data/vast_stuff_thr_xp</span>

c = 0.7;

[b ,stg]=  gia(meda_map,c);


<span class="comment">% GPCA</span>

[P,T] =  gpca(xcs,stg,1:4);

varX = trace(xcs'*xcs);
<span class="keyword">for</span> i=1:4
    figure
    t = T(:,i); <span class="comment">% score</span>
    lim = tinv(0.99,size(t,1)-1)*std(t)*sqrt(1+1/size(t,1));
    timestamps{i} = obs_l(find(t&gt;lim | t&lt;-lim));
    subplot(2,1,1), plot(t,<span class="string">'.-'</span>), hold <span class="string">on</span>, plot(-lim*ones(size(t)),<span class="string">'r--'</span>),plot(lim*ones(size(t)),<span class="string">'r--'</span>)
    ylabel(<span class="string">'Scores'</span>,<span class="string">'FontSize'</span>,20), axis <span class="string">tight</span>,
    xlabel(<span class="string">'Time'</span>,<span class="string">'FontSize'</span>,20)

    Xp = (T(:,i)*pinv(T(:,i)'*T(:,i))*T(:,i)')*xcs*(P(:,i)*pinv(P(:,i)'*P(:,i))*P(:,i)');
    varP = trace(Xp'*Xp);
    title(sprintf(<span class="string">'GC: %i, variance: %.0f%%'</span>,i,100*varP/varX),<span class="string">'FontSize'</span>,20)

    subplot(2,1,2), bar(P(ord,i)) <span class="comment">% loading</span>
    ylabel(<span class="string">'Lodings'</span>,<span class="string">'FontSize'</span>,20)
    xlabel(<span class="string">'Features'</span>,<span class="string">'FontSize'</span>,20)

<span class="keyword">end</span>
E = xcs - T*P';
varE = trace(E'*E);
ResidualVar = 100*(varE)/varX
</pre><pre class="codeoutput error">Error using gia (line 98)
Expected a string scalar or character vector for the parameter name, instead the input type was 'double'.

Error in ej_vast (line 118)
[b ,stg]=  gia(meda_map,c);
</pre><h2 id="5">XCAN: Centered data + X-thresholding</h2><pre class="codeinput">lambda = [.5]
varX = trace(xcs'*xcs);
<span class="keyword">for</span> k=1:length(lambda)

    [P, T] = xcan(xcs,1:4,meda_map,lambda(k),map_obs,lambda(k));

    <span class="keyword">for</span> i=1:4
        figure
        t = T(:,i); <span class="comment">% score</span>
        lim = tinv(0.99,size(t,1)-1)*std(t)*sqrt(1+1/size(t,1));
        timestamps{i} = obs_l(find(t&gt;lim | t&lt;-lim));
        subplot(2,1,1), plot(t,<span class="string">'.-'</span>), hold <span class="string">on</span>, plot(-lim*ones(size(t)),<span class="string">'r--'</span>),plot(lim*ones(size(t)),<span class="string">'r--'</span>)
        ylabel(<span class="string">'Scores'</span>,<span class="string">'FontSize'</span>,20), axis <span class="string">tight</span>,
        xlabel(<span class="string">'Time'</span>,<span class="string">'FontSize'</span>,20)

        Xp = (T(:,i)*pinv(T(:,i)'*T(:,i))*T(:,i)')*xcs*(P(:,i)*pinv(P(:,i)'*P(:,i))*P(:,i)');
        varP = trace(Xp'*Xp);
        title(sprintf(<span class="string">'XC: %i, variance: %.0f%%'</span>,i,100*varP/varX),<span class="string">'FontSize'</span>,20)

        subplot(2,1,2), bar(P(ord,i)) <span class="comment">% loading</span>
        ylabel(<span class="string">'Lodings'</span>,<span class="string">'FontSize'</span>,20)
        xlabel(<span class="string">'Features'</span>,<span class="string">'FontSize'</span>,20)

    <span class="keyword">end</span>

    E = xcs - T*P';
    varE = trace(E'*E);
    ResidualVar = 100*(varE)/varX
<span class="keyword">end</span>
</pre><h2 id="6">XCAN (only in the rows): Centered data + X-thresholding</h2><pre class="codeinput">lambda = [.5]
varX = trace(xcs'*xcs);
<span class="keyword">for</span> k=1:length(lambda)

    [P, T] = xcan(xcs,1:4,meda_map,lambda(k),map_obs,0);

    <span class="keyword">for</span> i=1:4
        figure
        t = T(:,i); <span class="comment">% score</span>
        lim = tinv(0.99,size(t,1)-1)*std(t)*sqrt(1+1/size(t,1));
        timestamps{i} = obs_l(find(t&gt;lim | t&lt;-lim));
        subplot(2,1,1), plot(t,<span class="string">'.-'</span>), hold <span class="string">on</span>, plot(-lim*ones(size(t)),<span class="string">'r--'</span>),plot(lim*ones(size(t)),<span class="string">'r--'</span>)
        ylabel(<span class="string">'Scores'</span>,<span class="string">'FontSize'</span>,20), axis <span class="string">tight</span>,
        xlabel(<span class="string">'Time'</span>,<span class="string">'FontSize'</span>,20)


        Xp = (T(:,i)*pinv(T(:,i)'*T(:,i))*T(:,i)')*xcs*(P(:,i)*pinv(P(:,i)'*P(:,i))*P(:,i)');
        varP = trace(Xp'*Xp);
        title(sprintf(<span class="string">'XC: %i, variance: %.0f%%'</span>,i,100*varP/varX),<span class="string">'FontSize'</span>,20)

        subplot(2,1,2), bar(P(ord,i)) <span class="comment">% loading</span>
        ylabel(<span class="string">'Lodings'</span>,<span class="string">'FontSize'</span>,20)
        xlabel(<span class="string">'Features'</span>,<span class="string">'FontSize'</span>,20)

    <span class="keyword">end</span>

    E = xcs - T*P';
    varE = trace(E'*E);
    ResidualVar = 100*(varE)/varX
<span class="keyword">end</span>
</pre><p class="footer"><br><a href="http://www.mathworks.com/products/matlab/">Published with MATLAB&reg; R2016b</a><br></p></div><!--
##### SOURCE BEGIN #####
%% XCAN example of VAST data
% J. Camacho, E. Acar, M. Rasmussen, R. Bro. Cross-product Penalized 
% Component Analysis (XCAN), Submitted to Chemometrics and Intelligent 
% Laboratory Systems, 2019.
%
% Needs the MEDA Toolbox (v1.6), the XCAN (path should be properly set, see
% README file) and Poblano Toolbox (v1.2)
%
% If you use these data, please add a reference to the below paper:
% 
%   Camacho, J., Rodríguez-Gómez, R., Saccenti, E. Group-wise Principal 
%   Component Analysis for Exploratory Data Analysis. Journal of 
%   Computational and Graphical Statistics , 2017, 26 (3): 501-512.
%
%   Camacho, J., Maciá-Fernández, G., Díaz-Verdejo, J., García-Teodoro, P. 
%   Tackling the Big Data 4 Vs for Anomaly Detection. INFOCOM'2014 Workshop 
%   on Security and Privacy in Big Data, Toronto (Canada), 2014.
%
% The VAST 2012 2nd mini challenge is a benchmark for visualization in cybersecurity 
% (http://www.vacommunity.org/VAST+Challenge+2012)
% 
% The goal is to identify cybersecurity issues in the data collected during two days from a
% computer network. During those days, a number of non-legitimate programs were found
% to be running on several computers, slowing them down. A cyber-forensics operation is
% required to discover the root causes for this strange behavior.
% 
% Two typical sources of data are collected from the network: firewall and Intrusion
% Detection System (IDS) logs. The firewall analyses the incoming and outgoing data traffic
% in the network, and records in a log file all connection attempts that are blocked according
% to security policies. The IDS employs higher level intelligence to identify cybersecurity
% incidents in data traffic. It also stores the results in a log file, though it does not block any
% traffic connection. Also, typically, it only analyses a sub-set (sample) of the total traffic.
% 
% A total of 2350 observations, each one with the information for one minute, are obtained.
% For every sampling period of one minute, we defined a set of 112 variables that represent
% the information from the two data sources: 69 variables for the firewall log and 43 for
% the IDS log. The number of variables was reduced to 95 by discarding those with constant 
% value throughout the capture period. The definition of the variables is
% introduced in Tackling the Big Data 4 Vs for Anomaly Detection. INFOCOM'2014 Workshop on 
% Security and Privacy in Big Data, Toronto (Canada), 2014.
%
% coded by: Jose Camacho Paez (josecamacho@ugr.es)
% last modification: 04/Feb/2025
%
% Copyright (C) 2025  University of Granada, Granada
% 
% This program is free software: you can redistribute it and/or modify
% it under the terms of the GNU General Public License as published by
% the Free Software Foundation, either version 3 of the License, or
% (at your option) any later version.
% 
% This program is distributed in the hope that it will be useful,
% but WITHOUT ANY WARRANTY; without even the implied warranty of
% MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
% GNU General Public License for more details.
% 
% You should have received a copy of the GNU General Public License
% along with this program.  If not, see <http://www.gnu.org/licenses/>.


%% Inicialization, remember to set the path of the toolbox

clear
close all
clc


%% Data prep & Selection of the PCs

load data/VAST

xcs = preprocess2D(x,'Preprocess',2,'Weights',weight_alt);

varPca(xcs,'Pcs',0:30,'Preprocessing',0); % 12 PCS could be a choice


%% Cross-product (XP) matrices

% XP matrices with no thresholding

meda_map = crossprod(xcs);
[meda_map2,ord] = seriation(meda_map);
plotMap(meda_map2);
ylabel('XtX','FontSize',20);

map_obs = crossprod(xcs');
plotMap(seriation(map_obs));
ylabel('XXt','FontSize',16);

save data/vast_stuff_xp

% XP matrices after thresholding

thr = 0.7; 
r = find(meda_map<thr);
meda_map(r) = 0;
[meda_map2,ord] = seriation(meda_map);
plotMap(meda_map2);
ylabel('XtX','FontSize',16);

thr = 0.3; 
r = find(map_obs<thr);
map_obs(r) = 0;
plotMap(seriation(map_obs));
ylabel('XXt','FontSize',16);

save data/vast_stuff_thr_xp


%% GPCA: Centered data + X-thresholding

close all
clc
load data/vast_stuff_thr_xp

c = 0.7;

[b ,stg]=  gia(meda_map,c);


% GPCA

[P,T] =  gpca(xcs,stg,1:4);

varX = trace(xcs'*xcs); 
for i=1:4
    figure
    t = T(:,i); % score
    lim = tinv(0.99,size(t,1)-1)*std(t)*sqrt(1+1/size(t,1));
    timestamps{i} = obs_l(find(t>lim | t<-lim));
    subplot(2,1,1), plot(t,'.-'), hold on, plot(-lim*ones(size(t)),'rREPLACE_WITH_DASH_DASH'),plot(lim*ones(size(t)),'rREPLACE_WITH_DASH_DASH')
    ylabel('Scores','FontSize',20), axis tight,
    xlabel('Time','FontSize',20)
    
    Xp = (T(:,i)*pinv(T(:,i)'*T(:,i))*T(:,i)')*xcs*(P(:,i)*pinv(P(:,i)'*P(:,i))*P(:,i)');
    varP = trace(Xp'*Xp);
    title(sprintf('GC: %i, variance: %.0f%%',i,100*varP/varX),'FontSize',20)
    
    subplot(2,1,2), bar(P(ord,i)) % loading
    ylabel('Lodings','FontSize',20)
    xlabel('Features','FontSize',20)
        
end
E = xcs - T*P';
varE = trace(E'*E);
ResidualVar = 100*(varE)/varX



%% XCAN: Centered data + X-thresholding

lambda = [.5]
varX = trace(xcs'*xcs); 
for k=1:length(lambda)
    
    [P, T] = xcan(xcs,1:4,meda_map,lambda(k),map_obs,lambda(k));
    
    for i=1:4
        figure
        t = T(:,i); % score
        lim = tinv(0.99,size(t,1)-1)*std(t)*sqrt(1+1/size(t,1));
        timestamps{i} = obs_l(find(t>lim | t<-lim));
        subplot(2,1,1), plot(t,'.-'), hold on, plot(-lim*ones(size(t)),'rREPLACE_WITH_DASH_DASH'),plot(lim*ones(size(t)),'rREPLACE_WITH_DASH_DASH')
        ylabel('Scores','FontSize',20), axis tight,
        xlabel('Time','FontSize',20)
        
        Xp = (T(:,i)*pinv(T(:,i)'*T(:,i))*T(:,i)')*xcs*(P(:,i)*pinv(P(:,i)'*P(:,i))*P(:,i)');
        varP = trace(Xp'*Xp);
        title(sprintf('XC: %i, variance: %.0f%%',i,100*varP/varX),'FontSize',20)
        
        subplot(2,1,2), bar(P(ord,i)) % loading
        ylabel('Lodings','FontSize',20)
        xlabel('Features','FontSize',20)
        
    end
    
    E = xcs - T*P';
    varE = trace(E'*E);
    ResidualVar = 100*(varE)/varX
end



%% XCAN (only in the rows): Centered data + X-thresholding

lambda = [.5]
varX = trace(xcs'*xcs); 
for k=1:length(lambda)
    
    [P, T] = xcan(xcs,1:4,meda_map,lambda(k),map_obs,0);

    for i=1:4
        figure
        t = T(:,i); % score
        lim = tinv(0.99,size(t,1)-1)*std(t)*sqrt(1+1/size(t,1));
        timestamps{i} = obs_l(find(t>lim | t<-lim));
        subplot(2,1,1), plot(t,'.-'), hold on, plot(-lim*ones(size(t)),'rREPLACE_WITH_DASH_DASH'),plot(lim*ones(size(t)),'rREPLACE_WITH_DASH_DASH')
        ylabel('Scores','FontSize',20), axis tight,
        xlabel('Time','FontSize',20)
        
            
        Xp = (T(:,i)*pinv(T(:,i)'*T(:,i))*T(:,i)')*xcs*(P(:,i)*pinv(P(:,i)'*P(:,i))*P(:,i)');
        varP = trace(Xp'*Xp);
        title(sprintf('XC: %i, variance: %.0f%%',i,100*varP/varX),'FontSize',20)
    
        subplot(2,1,2), bar(P(ord,i)) % loading
        ylabel('Lodings','FontSize',20)
        xlabel('Features','FontSize',20)
        
    end
    
    E = xcs - T*P';
    varE = trace(E'*E);
    ResidualVar = 100*(varE)/varX
end


##### SOURCE END #####
--></body></html>